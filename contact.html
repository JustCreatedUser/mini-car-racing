<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini-car racing ВРАЖЕННЯ</title>
    <link rel="stylesheet" href="./styles/contact/styles.css" />
    <link rel="icon" href="./icons-and-images/engine2.png" />
  </head>
  <body>
    <span
      style="
        position: absolute;
        font-size: 10vh;
        cursor: pointer;
        color: white;
        top: 2vh;
        right: 3vh;
      "
      onclick="window.close()"
      >&Cross;</span
    >
    <noscript>
      У вас заборонений Javascript. Перевірте налаштування браузеру
    </noscript>
    <input type="checkbox" id="checkboxCover" />
    <input type="checkbox" id="checkboxPage1" />
    <input type="checkbox" id="checkboxPage2" />
    <form action="https://formspree.io/f/xeqywdpp" method="POST">
      <div class="cover" id="cover">
        <div class="front-page" style="transform: translateZ(1px)">
          Тут ти заповнюєш анкету інформацією
        </div>
        <div
          class="back-page"
          style="transform: rotateY(180deg) translateZ(-1px)"
        >
          Це буде адресовано автору гри!
        </div>
        <label for="checkboxCover"></label>
      </div>
      <label class="page" id="page1">
        <div class="front-page">
          <label for="checkboxPage1" style="justify-self: end; align-self: end"
            >&rarr;</label
          >
          <span>Ваша електронна пошта</span>
          <input
            id="email"
            type="email"
            name="email"
            placeholder="me@gmail.com"
            required
            autocomplete="off"
          />
        </div>
        <div class="back-page">
          <label
            style="justify-self: start; align-self: end"
            for="checkboxPage1"
            >&larr;</label
          >
          <span>Ваша оцінка з 10 балів</span>
          <input
            type="number"
            name="rating"
            min="0"
            max="10"
            step="0.1"
            id="rating"
            required
            autocomplete="off"
            placeholder="10?"
          />
        </div>
      </label>
      <label class="page" id="page2">
        <div class="front-page">
          <label for="checkboxPage2" style="justify-self: end; align-self: end"
            >&rarr;</label
          >
          <span style="justify-self: center">Ваша думка:</span>
          <textarea
            required
            placeholder="Розробник зверне увагу!"
            name="message"
            id="message"
          ></textarea>
        </div>
        <div class="back-page">
          <button type="submit" onclick="checkInputs()">Надіслати</button>
          <label
            for="checkboxPage2"
            style="justify-self: start; align-self: end"
            >&larr;</label
          >
        </div>
      </label>
      <div class="back-cover"></div>
    </form>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"
      integrity="sha512-+k1pnlgt4F1H8L7t3z95o3/KO+o78INEcXTbnoJQ/F2VqDVhWoaiVml/OEHv9HsVgxUaVW+IbiZPUJQfF/YxZw=="
      crossorigin="anonymous"
    ></script>
    <script>
      const sessionStorageInputs = sessionStorage.contactInputs
        ? JSON.parse(sessionStorage.contactInputs)
        : {
            email: "",
            message: "",
            rating: "",
          };
      for (const key in sessionStorageInputs) {
        document.querySelector(`#${key}`).value = sessionStorageInputs[key];
      }
      const lang = localStorage.getItem("language")
        ? localStorage.getItem("language")
        : "ukrainian";
      function setLanguage() {
        if (lang == "english") {
          document.querySelector("#cover .back-page").textContent =
            "It will be sent to the author of game";
          document.querySelector("#cover .front-page").textContent =
            "Here you should complete an application form";
          document.querySelector("#page1 .front-page span").textContent =
            "Your email";
          document.querySelector("#page1 .back-page span").textContent =
            "Your rating out of 10";
          document.querySelector("#page2 .front-page span").textContent =
            "Your thoughts";
          document.querySelector('button[type="submit"]').textContent = "Send";
          document.querySelector("textarea").placeholder =
            "Developer will pay close attention to it!";
        }
      }
      setLanguage();
      function checkRating() {
        if (rating.value >= 8) {
          if (rating.value > 10) rating.value = 10;
          rating.style.color = "green";
        } else if (rating.value < 5) rating.style.color = "red";
        else rating.style.color = "black";
        rating.value = rating.value.replace("+", "");
        rating.value = rating.value.replace("-", "");
      }
      function changeBorder(e) {
        e.target.style.border =
          e.target.value == "" ? "2px solid red" : "2px solid green";
      }
      function fixAnimation(e) {
        let checked = e.target.checked;
        let el = `#${e.target.id.replace("checkbox", "").toLowerCase()}`;
        let neededPosition = (Number($(el).css("z-index")) - 4) * -1;
        setTimeout(() => {
          if (e.target == checkboxCover) {
            if (checked) {
              document.querySelector(
                ".cover .back-page"
              ).style.backfaceVisibility = "visible";
              document.querySelector(".cover .front-page").style.visibility =
                "hidden";
            } else {
              document.querySelector(
                ".cover .back-page"
              ).style.backfaceVisibility = "hidden";
              document.querySelector(".cover .front-page").style.visibility =
                "visible";
            }
          } else {
            if (checked) {
              document.querySelector(el + ` .front-page`).style.visibility =
                "hidden";
              document.querySelector(el + ` .back-page`).style.visibility =
                "visible";
            } else {
              document.querySelector(el + ` .front-page`).style.visibility =
                "visible";
              document.querySelector(el + ` .back-page`).style.visibility =
                "hidden";
            }
          }
          document.querySelector(el).style.zIndex = `${neededPosition}`;
        }, 250);
      }
      function checkInputs() {
        let completedInputs = inputs.filter((element) => element.value != "");
        sessionStorage.contactInputs = JSON.stringify({
          email: email.value,
          rating: rating.value,
          message: message.value,
        });
        if (
          email.value.replaceAll("@gmail.com", "") == "" ||
          completedInputs.length != 3
        )
          alert(
            lang == "ukrainian"
              ? "Заповніть ПОТРІБНІ поля"
              : "Fill ESSENTIAL inputs"
          );

        labels.forEach((element) => {
          element.checked = false;
        });
        document.querySelector(".cover .back-page").style.backfaceVisibility =
          "hidden";
        document.querySelector(".cover .front-page").style.visibility =
          "visible";
        cover.style.zIndex = 4;
        page1.style.zIndex = 3;
        page2.style.zIndex = 2;
        location.reload();
      }
      email.onblur = () => {
        if (
          !email.value.includes("@gmail.com") ||
          email.value.replaceAll("@gmail.com", "") == ""
        ) {
          alert(lang == "ukrainian" ? "Неправильний email" : "Wrong email");
          setTimeout(() => {
            email.focus();
          }, 100);
        }
      };
      email.oninput = changeBorder;
      rating.onclick = changeBorder;
      rating.oninput = function (e) {
        changeBorder(e);
        checkRating();
      };
      email.onclick = changeBorder;
      message.oninput = changeBorder;
      message.onclick = changeBorder;
      email.click();
      rating.click();
      message.click();
      let inputs = [email, rating, message];
      let labels = [checkboxCover, checkboxPage1, checkboxPage2];
      labels.forEach((element) => {
        element.oninput = fixAnimation;
      });
    </script>
  </body>
</html>
